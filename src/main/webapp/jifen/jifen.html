<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>积分</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/layui/css/layui.css" media="all">
    <script src="/js/jquery-3.3.1.min.js"></script>
    <script src="/layui/layui.js"></script>
    <script>
        var user = "";
        var jifen="";
        $(function () {
            /*获取穿过来的积分和userid*/
             user = sessionStorage.getItem("userId");
             jifen = sessionStorage.getItem("jifen")
            /*console.log("这是传过来的"+user);
            console.log("这是传过来的"+jifen);
            alert("...sessionStorage......")*/
            if (user == null) {
                window.location.href = "../user/login.html";
            }

        })
    </script>
</head>
<body>

<!--导航条-->
<div>
    <ul class="layui-nav" lay-filter="">
        <li class="layui-nav-item"><a href="/user/index.html">四川票务网</a></li>
        <li class="layui-nav-item layui-this"><a href="">关于我们</a></li>
        <li class="layui-nav-item"><a href="">帮助中心</a></li>
        <li class="layui-nav-item">
            <a href="javascript:;">问题建议</a>

        </li>
        <!--        <li class="layui-nav-item"><a href="">社区</a></li>-->
    </ul>
</div>

<!--<ins class="adsbygoogle" style="display:inline-block;width:970px;height:90px" data-ad-client="ca-pub-6111334333458862" data-ad-slot="3820120620"></ins>

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
    &lt;!&ndash;<legend>Hash地址定位</legend>&ndash;&gt;
</fieldset>-->
<div class="layui-tab" lay-filter="test">
    <ul class="layui-tab-title">
        <li class="layui-this" lay-id="22" id="jifen">积分查询</li>
        <li lay-id="33" id="jifenxiaofei">消费积分详情查询</li>
        <li lay-id="44" id="jifenhuoqu">获取积分详情查询</li>
    </ul>
    <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
            我的积分:<input value="" id="jifen1" readonly>
        </div>
        <div class="layui-tab-item">
            <table id="mytable">
                <tr>
                    <td>序号</td>
                    <td>消费积分数</td>
                    <td>消费积分日期</td>
                </tr>
            </table>
            <div>总共多少条:<span id="count"></span>条</div>
            <div>总共多少页:<span id="allPage"></span>页</div>
            <div>当前第几页:<span id="nowPage"></span>页</div>
            <div>每页显示多少条:<input type="text" id="showCount" value="7">条</div>
            <button onclick="ff('1')">首页</button>&nbsp;&nbsp;&nbsp;
            <button onclick="ff('-1')">上一页</button>&nbsp;&nbsp;&nbsp;
            <button onclick="ff('+1')">下一页</button>&nbsp;&nbsp;&nbsp;
            <button onclick="ff('0')">末页</button>&nbsp;&nbsp;&nbsp;
            <div id="onlyPage"></div>
        </div>
        <div class="layui-tab-item">
            <table id="mytable1">
                <tr>
                    <td>序号</td>
                    <td>消费积分数</td>
                    <td>消费积分日期</td>
                </tr>
            </table>
            <div>总共多少条:<span id="count1"></span>条</div>
            <div>总共多少页:<span id="allPage1"></span>页</div>
            <div>当前第几页:<span id="nowPage1"></span>页</div>
            <div>每页显示多少条:<input type="text" id="showCount1" value="7">条</div>
            <button onclick="ff('1')">首页</button>&nbsp;&nbsp;&nbsp;
            <button onclick="ff('-1')">上一页</button>&nbsp;&nbsp;&nbsp;
            <button onclick="ff('+1')">下一页</button>&nbsp;&nbsp;&nbsp;
            <button onclick="ff('0')">末页</button>&nbsp;&nbsp;&nbsp;
            <div id="onlyPage1"></div>
        </div>
    </div>
</div>

<hr class="layui-bg-gray">
<!--<div class="layui-container">
    <button id="jifen" name="jifen" class="main-container" >积分查询</button>
    <button id="jifenxiaofei" name="jifen" class="main-container" >消费积分详情查询</button>
    <button id="jifenhuoqu" name="jifen" class="main-container" >获取积分详情查询</button>
</div>-->


<script>
    $(function jifen(){

        $("#jifen1").attr("value",sessionStorage.getItem("jifen"));
    })
    //积分查询
    $("#jifen").on('click',function(){
        var userId = sessionStorage.getItem("userId");
        var user = {id: userId};
        $.ajax({
            url: "/chaXunJiFen",   // 请求路径  url-pattern  基于当前工程的绝对路径
            type: "post",            // 请求的方式，不区分大小写
            async: true,             // 是否异步，true是默认值，false为同步请求
            cache: false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
            datatype: "json",        // 返回类型，text文本、html页面、json数据
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(user),  // k-v参数
            success: function (data){
                /*console.log(JSON.stringify(data));
                console.log(JSON.stringify(data.jiFen));
                alert("........");*/
                    $("#jifen1").attr("value",data.jiFen);
            },
            error: function (data) {
                alert(".......")
                console.log("数据异常");
            }
        });
    });
   //常见一个时间对象
    var newDate = new Date();
    //消费积分详情查询
    $("#jifenxiaofei").on('click',function(){
        var userId = sessionStorage.getItem("userId");
        // 默认nowPage从第一页开始
        var nowPage = 1;
        var endPage = 0;
        function ff(nowPageParam) {
            /*console.log("nowPageParam=" + nowPageParam);*/
            if(nowPageParam === 1 || nowPageParam === '1') {
                /*console.log("封装首页:" + nowPageParam);*/
                nowPage = 1;
            }
            else if(nowPageParam == '0') {   // 如果click时间传递的是0，代表最后一页，把总页码传递给当前页码
                nowPage = endPage;
            }
            else {
                /*console.log(nowPage + nowPageParam);*/
                nowPage = eval(nowPage + nowPageParam);
            }
            /*console.log("nowPage=" + nowPage);*/

            var user = {id: userId,"nowPage":nowPage,"showCount":$("#showCount").val()};

            $.ajax({
                url: "/chaJiFenXiaoFei",   // 请求路径  url-pattern  基于当前工程的绝对路径
                type: "post",            // 请求的方式，不区分大小写
                async: true,             // 是否异步，true是默认值，false为同步请求
                cache: false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
                datatype: "json",        // 返回类型，text文本、html页面、json数据
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify(user),  // nowPage代表第一页，showCount代表每页显示多少条
                success: function (data) {
                    /*console.log(JSON.stringify(data));*/
                    if(data.code == 200) {
                        // 把后台服务传递过来的总页码，当做最后一页的页码处理
                        endPage = data.allPage;
                        nowPage = data.nowPage;
                        // 获取总条数
                        $("#count").html(data.PageInfo.total);
                        // 获取总页数
                        $("#allPage").html(data.PageInfo.pages);
                        // 获取当前页码
                        $("#nowPage").html(data.PageInfo.pageNum);

                        $("#mytable").html("<tr>\n" +
                            "            <td>序号</td>\n" +
                            "            <td>消费积分数</td>\n" +
                            "            <td>消费积分日期</td>\n" +
                            "        </tr>");
                        for(x in data.page) { //  "0" + "1"  = "0+1"
                            var timestamp3 = data.page[x].shiYongShiJian;
                            newDate.setTime(timestamp3);
                            /*console.log(newDate.toLocaleDateString());*/
                            $("#mytable").append("<tr>\n" +
                                "            <td>" + eval(x + "+1") + "</td>\n" +
                                "            <td>" + data.page[x].xiaoFeiJiFen + "</td>\n" +
                                "            <td>" + newDate.toLocaleDateString() + "</td>\n" +
                                "        </tr>");
                        }

                        $("#onlyPage").html("");
                        for(var i = 0; i < endPage; i++) {
                            if(i == 0) {
                                $("#onlyPage").append("<a href=\"#\" onclick=\"ff2('1')\">1</a>&nbsp;&nbsp;&nbsp;");
                            }
                            else {
                                $("#onlyPage").append("<a href=\"#\" onclick=\"ff2('" + (i + 1) + "')\">" + (i + 1) + "</a>&nbsp;&nbsp;&nbsp;");
                            }
                        }
                    }
                    else {
                        alert(data.msg);
                    }
                },
                error: function (data) {
                    console.log("请求错误:" + JSON.stringify(data));
                }
            });
        }
        ff(nowPage);



        function ff2(nowPageParam) {
            var userId = sessionStorage.getItem("userId");

            console.log("nowPageParam=" + nowPageParam);

            $.ajax({
                url: "/chaJiFenXiaoFei",   // 请求路径  url-pattern  基于当前工程的绝对路径
                type: "post",            // 请求的方式，不区分大小写
                async: true,             // 是否异步，true是默认值，false为同步请求
                cache: false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
                datatype: "json",        // 返回类型，text文本、html页面、json数据
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify({id:userId,"nowPage":nowPageParam,"showCount":$("#showCount").val()}),  // nowPage代表第一页，showCount代表每页显示多少条
                success: function (data) {
                    /*console.log(JSON.stringify(data));*/
                    if(data.code == 200) {
                        // 把后台服务传递过来的总页码，当做最后一页的页码处理
                        endPage = data.allPage;
                        nowPage = data.nowPage;
                        // 获取总条数
                        $("#count").html(data.PageInfo.total);
                        // 获取总页数
                        $("#allPage").html(data.PageInfo.pages);
                        // 获取当前页码
                        $("#nowPage").html(data.PageInfo.pageNum);

                        $("#mytable").html("<tr>\n" +
                            "            <td>序号</td>\n" +
                            "            <td>消费积分数</td>\n" +
                            "            <td>消费积分日期</td>\n" +
                            "        </tr>");
                        for(x in data.page) { //  "0" + "1"  = "0+1"
                            var timestamp3 = data.page[x].shiYongShiJian;
                            newDate.setTime(timestamp3);
                            /*console.log(newDate.toLocaleDateString());*/
                            $("#mytable").append("<tr>\n" +
                                "            <td>" + eval(x + "+1") + "</td>\n" +
                                "            <td>" + data.page[x].xiaoFeiJiFen + "</td>\n" +
                                "            <td>" + newDate.toLocaleDateString() + "</td>\n" +
                                "        </tr>");
                        }

                        $("#onlyPage").html("");
                        for(var i = 0; i < endPage; i++) {
                            if(i == 0) {
                                $("#onlyPage").append("<a href=\"#\" onclick=\"ff2('1')\">1</a>&nbsp;&nbsp;&nbsp;");
                            }
                            else {
                                $("#onlyPage").append("<a href=\"#\" onclick=\"ff2('" + (i + 1) + "')\">" + (i + 1) + "</a>&nbsp;&nbsp;&nbsp;");
                            }
                        }
                    }
                    else {
                        alert(data.msg);
                    }
                },
                error: function (data) {
                    console.log("请求错误:" + JSON.stringify(data));
                }
            });
        }
        /*$.ajax({
            url: "/chaJiFenXiaoFei",   // 请求路径  url-pattern  基于当前工程的绝对路径
            type: "post",            // 请求的方式，不区分大小写
            async: true,             // 是否异步，true是默认值，false为同步请求
            cache: false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
            datatype: "json",        // 返回类型，text文本、html页面、json数据
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(user),  // k-v参数
            success: function (data){
                console.log(JSON.stringify(data));
                alert("........");


            },
            error: function (data) {
                alert(".......")
                console.log("数据异常");
            }
        });*/

    });

    //获取积分详情查询
    $("#jifenhuoqu").on('click',function(){
        var userId = sessionStorage.getItem("userId");
        // 默认nowPage从第一页开始
        var nowPage1 = 1;
        var endPage1 = 0;
        function ff(nowPageParam) {
            /*console.log("nowPageParam=" + nowPageParam);*/
            if(nowPageParam === 1 || nowPageParam === '1') {
                /*console.log("封装首页:" + nowPageParam);*/
                nowPage1 = 1;
            }
            else if(nowPageParam == '0') {   // 如果click时间传递的是0，代表最后一页，把总页码传递给当前页码
                nowPage1 = endPage1;
            }
            else {
                console.log(nowPage1 + nowPageParam);
                nowPage1 = eval(nowPage1 + nowPageParam);
            }
            /*console.log("nowPage=" + nowPage1);*/

            var user = {id: userId,"nowPage":nowPage1,"showCount":$("#showCount1").val()};

            $.ajax({
                url: "/chaXunJiFenHuoQu",   // 请求路径  url-pattern  基于当前工程的绝对路径
                type: "post",            // 请求的方式，不区分大小写
                async: true,             // 是否异步，true是默认值，false为同步请求
                cache: false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
                datatype: "json",        // 返回类型，text文本、html页面、json数据
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify(user),  // nowPage代表第一页，showCount代表每页显示多少条
                success: function (data) {
                    /*console.log(JSON.stringify(data));*/
                    if(data.code == 200) {
                        // 把后台服务传递过来的总页码，当做最后一页的页码处理
                        endPage = data.allPage1;
                        nowPage = data.nowPage1;
                        // 获取总条数
                        $("#count1").html(data.PageInfo.total);
                        // 获取总页数
                        $("#allPage1").html(data.PageInfo.pages);
                        // 获取当前页码
                        $("#nowPage1").html(data.PageInfo.pageNum);

                        $("#mytable1").html("<tr>\n" +
                            "            <td>序号</td>\n" +
                            "            <td>获取积分数</td>\n" +
                            "            <td>获取积分日期</td>\n" +
                            "        </tr>");
                        for(x in data.page) { //  "0" + "1"  = "0+1"
                            var timestamp3 = data.page[x].time;
                            newDate.setTime(timestamp3);
                            /*console.log(newDate.toLocaleDateString());*/
                            $("#mytable1").append("<tr>\n" +
                                "            <td>" + eval(x + "+1") + "</td>\n" +
                                "            <td>" + data.page[x].huoQuJiFen+ "</td>\n" +
                                "            <td>" + newDate.toLocaleDateString() + "</td>\n" +
                                "        </tr>");
                        }

                        $("#onlyPage1").html("");
                        for(var i = 0; i < endPage; i++) {
                            if(i == 0) {
                                $("#onlyPage1").append("<a href=\"#\" onclick=\"ff2('1')\">1</a>&nbsp;&nbsp;&nbsp;");
                            }
                            else {
                                $("#onlyPage1").append("<a href=\"#\" onclick=\"ff2('" + (i + 1) + "')\">" + (i + 1) + "</a>&nbsp;&nbsp;&nbsp;");
                            }
                        }
                    }
                    else {
                        alert(data.msg);
                    }
                },
                error: function (data) {
                    console.log("请求错误:" + JSON.stringify(data));
                }
            });
        }
        ff(nowPage1);



        function ff2(nowPageParam) {
            var userId = sessionStorage.getItem("userId");

            console.log("nowPageParam=" + nowPageParam);

            $.ajax({
                url: "/chaJiFenXiaoFei",   // 请求路径  url-pattern  基于当前工程的绝对路径
                type: "post",            // 请求的方式，不区分大小写
                async: true,             // 是否异步，true是默认值，false为同步请求
                cache: false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
                datatype: "json",        // 返回类型，text文本、html页面、json数据
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify({id:userId,"nowPage":nowPageParam,"showCount":$("#showCount1").val()}),  // nowPage代表第一页，showCount代表每页显示多少条
                success: function (data) {
                    /*console.log(JSON.stringify(data));*/
                    if(data.code == 200) {
                        // 把后台服务传递过来的总页码，当做最后一页的页码处理
                        endPage = data.allPage1;
                        nowPage = data.nowPage1;
                        // 获取总条数
                        $("#count1").html(data.PageInfo.total);
                        // 获取总页数
                        $("#allPage1").html(data.PageInfo.pages);
                        // 获取当前页码
                        $("#nowPage1").html(data.PageInfo.pageNum);

                        $("#mytable1").html("<tr>\n" +
                            "            <td>序号</td>\n" +
                            "            <td>消费积分数</td>\n" +
                            "            <td>消费积分日期</td>\n" +
                            "        </tr>");
                        for(x in data.page) { //  "0" + "1"  = "0+1"
                            var timestamp3 = data.page[x].time;
                            newDate.setTime(timestamp3);
                            /*console.log(newDate.toLocaleDateString());*/
                            $("#mytable1").append("<tr>\n" +
                                "            <td>" + eval(x + "+1") + "</td>\n" +
                                "            <td>" + data.page[x].huoQuJiFen + "</td>\n" +
                                "            <td>" + newDate.toLocaleDateString() + "</td>\n" +
                                "        </tr>");
                        }

                        $("#onlyPage1").html("");
                        for(var i = 0; i < endPage; i++) {
                            if(i == 0) {
                                $("#onlyPage1").append("<a href=\"#\" onclick=\"ff2('1')\">1</a>&nbsp;&nbsp;&nbsp;");
                            }
                            else {
                                $("#onlyPage1").append("<a href=\"#\" onclick=\"ff2('" + (i + 1) + "')\">" + (i + 1) + "</a>&nbsp;&nbsp;&nbsp;");
                            }
                        }
                    }
                    else {
                        alert(data.msg);
                    }
                },
                error: function (data) {
                    console.log("请求错误:" + JSON.stringify(data));
                }
            });
        }
        /*$.ajax({
            url: "/chaXunJiFenHuoQu",   // 请求路径  url-pattern  基于当前工程的绝对路径
            type: "post",            // 请求的方式，不区分大小写
            async: true,             // 是否异步，true是默认值，false为同步请求
            cache: false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
            datatype: "json",        // 返回类型，text文本、html页面、json数据
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(user),  // k-v参数
            success: function (data){
                console.log(JSON.stringify(data));
                alert("........");
            },
            error: function (data) {
                alert(".......")
                console.log("数据异常");
            }
        });*/

    });

</script>


<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
    layui.use('element', function(){
        var $ = layui.jquery
            ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

        //触发事件
        var active = {
            tabAdd: function(){
                //新增一个Tab项
                element.tabAdd('demo', {
                    title: '新选项'+ (Math.random()*1000|0) //用于演示
                    ,content: '内容'+ (Math.random()*1000|0)
                    ,id: new Date().getTime() //实际使用一般是规定好的id，这里以时间戳模拟下
                })
            }
            ,tabDelete: function(othis){
                //删除指定Tab项
                element.tabDelete('demo', '44'); //删除：“商品管理”


                othis.addClass('layui-btn-disabled');
            }
            ,tabChange: function(){
                //切换到指定Tab项
                element.tabChange('demo', '22'); //切换到：用户管理
            }
        };

        $('.site-demo-active').on('click', function(){
            var othis = $(this), type = othis.data('type');
            active[type] ? active[type].call(this, othis) : '';
        });

        //Hash地址的定位
        var layid = location.hash.replace(/^#test=/, '');
        element.tabChange('test', layid);

        element.on('tab(test)', function(elem){
            location.hash = 'test='+ $(this).attr('lay-id');
        });

    });
</script>
</body>
</html>